원본이 저장된 노션 링크입니다 
https://shell-breakfast-4f4.notion.site/2023-05-01-1b385b7b0a1446ba8f37eb30372a76c4
# 2023.05.01 [실행 컨텍스트]

<aside>
💡 참고자료: 모던 자바스크립트 딥다이브 23장

</aside>

# 1. **실행 컨텍스트(Execution Context)에 대해서 설명해주세요.**

<aside>
3️⃣ 키워드 :  **식별자, 스코프, 코드 실행 순서**
1. 선언에 의해 생성된 모든 식별자를 스코프를 구분하여 등록, 상태 변화를 지속적으로 관리할 수 있어야 함.
2. 스코프는 중첩 관계에 의해 스코프 체인을 형성해야 함. 즉 스코프 체인을 통해 상위 스코프로 이동하며 식별자를 검색할 수 있어야 함. 
3. 현재 실행 중인 코드의 실행 순서를 변경할 수 있어야 하며 다시 되돌아갈 수 있어야 함.

**결론: 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역**

</aside>

식별자와 스코프는 렉시컬 환경에서 관리하고 코드 실행 순서는 실행 컨텍스트 스택으로 관리한다. 

### 다음 코드를 보고 실행 컨텍스트 스택을 예상해 보자!

```jsx
const x = 1;
function foo() {
	const y = 2;
	function bar() {
		const z = 3; 
		console.log(x+y+z);
	}
	bar();
}

foo();
```

- 정답
    1. 전역 코드의 평가와 실행 : 전역 실행 컨텍스트 (전역 변수 x 와 전역 함수 foo 등록(평가 과정) 뒤 실행 → 전역 변수 할당되고 함수 호출됨.)
    2. foo 함수 코드의 평가와 실행 : 제어권이 foo 함수 내부로 이동. 코드 평가 및 실행 …
    3. bar 함수 코드의 평가와 실행
    4. foo 함수 코드로의 복귀 but 실행할 코드 없어서 종료  
    5. 전역 코드로 복귀 but 실해할 코드 없어서 종료 → 실행 컨택스트 스택이 비게 됨.
    

### 꿀팁: 실행 컨텍스트 스택의 최상위에 존재하는 스택은 언제나 현재 실행 중인 코드의 실행 컨텍스트이다. 따라서 이를 실행 중인 실행 컨텍스트라 한다!!

# 2.렉시컬 환경이란 무엇인가요?

<aside>
2️⃣ 키워드 : 실행 컨텍스트를 구성하는 컴포넌트로, **식별자와 스코프 관리
객체 형태의 스코프를 생성하여 식별자를 키로 등록함으로써 스코프를 구분하여 식별자를 등록하고 관리한다.**

</aside>

환경 레코드와 외부 렉시컬 환경에 대한 참조 두 부분으로 구성되어 있다. 전자는 식별자, 후자는 스코프를 관리하는 데 쓰인다. 
** 전역 환경 레코드의 경우 객체 환경 레코드(var, 빌트인 전역)와 선언적 환경 레코드(let, const)로 나뉜다. 

### 실행 컨텍스트의 생성과 코드 실행 결과가 어떻게 관리되는지, 어떻게 실행 컨텍스트를 통해 식별자를 검색하는지 설명해 주세요.

```jsx
var x = 1;
const y = 2;

function foo(a) {
	var x = 3;
	const y = 4;

	function bar (b) {
		const z = 5;
		console.log(a + b + x + y + z);
	}
	bar(10);
}

foo(20);
```

- 정답
    1. 가장 근본, 전역 객체 생성 (빌트인 전역 프로퍼티, 함수, 객체 등이 추가되고 클라이언트 사이드 Web Api, DOM, SVG, Web storage 같은 것들 추가됨.)
    2. 전역 코드 평가 및 실행
    1. 전역 실행 컨텍스트 생성
    2. 전역 렉시컬 환경 생성 - 전역 환경 레코드 생성, this 바인딩, 외부 렉시컬 환경에 대한 참조 결정
    2-1. 전역 환경 레코드 생성. var, 전역 변수, 전역 함수는 전역 스코프를 가지게 됨. (전역 객체의 프로퍼티와 메소드가 된다)(x 선언 및 초기화 var 이기 때문에, undefined 로)
    2-2. 선언적 환경 레코드 생성. const y 선언 
    2-3. 외부 렉시컬 환경에 대한 참조 설정. 전역이니까 null 
    3. 전역 코드 실행 → 변수에 값 할당. 이때 식별자 결정을 통해 서로 다른 스코프에 있는 동명이인 식별자 구분
    3. foo 함수 코드 평가 및 실행
    1. 함수 실행 컨텍스트 생성
    2. 함수 렉시컬 환경 생성 
    2-1. 함수 환경 레코드 생성 
    2-2. this 바인딩
    2-3. 외부 렉시컬 환경에 대한 참조 결정  
    4. bar 함수 코드 평가 및 실행
    평가 과정은 foo 함수와 동일
    1. console 식별자 검색 → 스코프 체인을 ㄸ라 전역 렉시컬 환경으로 이동하여 검색
    2. console 객체에서 log 메서드 검색 
    3. 표현식 a + b + x + y + z 평가. 스코프 체인을 따라 검색 
    4. console.log 메서드 호출 
    5. bar 함수 코드 실행 종료 (이때 렉시컬 환경까지 제거되지는 않고, 객체를 필요한 모든 값이 누군가에 의해 참조되지 않을 때 가비지 컬렉터에 의해 소멸)
    6. foo 함수 코드 실행 종료 
    7. 전역 코드 실행 종료 
     

## 실행 컨텍스트와 블록 레벨 스코프

```jsx
let x = 1;
if (true) {
	let x = 10; 
	console.log(x);
}

console.log(x);
```

블록 레벨 스코프를 생성하기 위해, 선언적 환경 레코드를 갖는 렉시컬 환경을 새롭게 생성해 기존의 전역 렉시컬 환경을 교체해야 한다. 이때 새롭게 생성된 if 문의 코드 블록을 위한 렉시컬 환경의 외부 렉시컬 환경에 대한 참조는 if 문이 실행되기 이전의 전역 렉시컬 환경을 가리킨다. 

## 코드 문제

### 다음 코드들의 실행 결과를 이유와 함께 이야기해 주세요